<!doctype html>
<html>
  <head>
    <title>o2r-informer test page</title>
    <style>
    </style>
  </head>
  <body>
    <pre id="jobid" style="border: 1px solid blue;"></pre>
    <pre id="status" style="border: 1px solid black;"></pre>
    <pre id="log" style="border: 1px solid black;"></pre>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script>
      // Setup socket.io to connect to the server and the namespace '/api/v1/logs/job'.
      var socket = io('http://localhost/api/v1/logs/job');
      //var socket = io('https://o2r.uni-muenster.de/api/v1/logs/job');
      //var socket = io('http://ubsvirt148.uni-muenster.de/api/v1/logs/job');
      socket.on('connect', function(data) {
        console.log('connected!');
      });


      function update(event) {
        // This will hold the Job ID the data relates to.
        document.getElementById("jobid").innerHTML = event.id;
        if(event.steps.image_build !== undefined) {
          document.getElementById("status").innerHTML = event.steps.image_build.status;
          switch (event.steps.image_build.status) {
            case "queued":
              document.getElementById("log").style.backgroundColor = "#f0f0f0";
              break;
            case "running":
              document.getElementById("log").style.backgroundColor = "#ffffdd";
              break;
            case "success":
              document.getElementById("log").style.backgroundColor = "#ddffdd";
              break;
            case "failure":
              document.getElementById("log").style.backgroundColor = "#ffdddd";
              break;
            default:
              break;
          }
        }
        if(event.steps.validate_bag !== undefined && event.steps.validate_bag.text !== undefined) {
          document.getElementById("log").innerHTML += "VALIDATE BAG:        " + event.steps.validate_bag.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
        if(event.steps.validate_compendium !== undefined && event.steps.validate_compendium.text !== undefined) {
          document.getElementById("log").innerHTML += "VALIDATE COMPENDIUM: " + event.steps.validate_compendium.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
        if(event.steps.validate_dockerfile !== undefined && event.steps.validate_dockerfile.text !== undefined) {
          document.getElementById("log").innerHTML += "VALIDATE DOCKERFILE: " + event.steps.validate_dockerfile.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
        if(event.steps.image_build !== undefined && event.steps.image_build.text !== undefined) {
          document.getElementById("log").innerHTML += "IMAGE BUILD:         " + event.steps.image_build.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
        if(event.steps.image_execute !== undefined && event.steps.image_execute.text !== undefined) {
          document.getElementById("log").innerHTML += "IMAGE EXECUTE:       " + event.steps.image_execute.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
        if(event.steps.cleanup !== undefined && event.steps.cleanup.text !== undefined) {
          document.getElementById("log").innerHTML += "CLEANUP:             " + event.steps.cleanup.text;
          window.scrollTo(0,document.body.scrollHeight);
        }
      }

      socket.on("document", update);
      socket.on("set", update);
    </script>
  </body>
</html>
